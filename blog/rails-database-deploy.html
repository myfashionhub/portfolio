<div class='excerpt'>
  <h3>How to deploy a Rails app safely into your production database</h3>

  <p>
    Traditionally there're a few ways to <a href="http://stackoverflow.com/questions/10301794/difference-between-rake-dbmigrate-dbreset-and-dbschemaload">set up your Rails database</a>:
  </p>
  <ul>
    <li>
      <code>rake db:create db:migrate</code><br/>
    Create a new database and run migrations
    </li>
    <li>
      <code>rake db:schema:load</code><br/>
    Drop database if it exists and create tables according to your schema.
    </li>
    <li>
      <code>rake db:setup</code><br/>
      Will run both <code>rake db:schema:load</code> and <code>rake db:seed</code>
    </li>
  </ul>

  <p>
    But what if you want to create tables for your Rails app in an existing database with other important data?
  </p>

  <button class='more active'>Read more</button>
</div>

<div class="full-text">
  <a href="https://myfashionhub.files.wordpress.com/2014/12/rails.jpg"><img src="https://myfashionhub.files.wordpress.com/2014/12/rails.jpg?w=300" alt="rails deployment" width="300" height="225" style='float:right; margin-left:15px;' /></a>

  <p>
    <code>db:schema:load</code> is problematic. It is suggested in Rails schema.rb file that this is an efficient way (compared to db:migrate) to set up your database. However, it assumes that a) you have a database dedicated to the Rails app, b) have no existing data.
  </p>

  <p>
    Here's a guide I've come up with on how to integrate your Rails app into an existing database by forgoing migrations.
  </p>

  <h4>1. Create tables in your production database</h4>
  <p>
    Feel free to namespace them like this: myproject_users instead of the usual users.
  </p>

  <h4>2. Edit database.yml</h4>
  <p>
    Specify the name of your database and the user/password that has access to it under the corresponding environment setting (development or production).
  </p>

  <h4>3. Void migration files</h4>
  <p>
    Under db/migrate, either comment out the files' content or change their extension to .txt.
  </p>

  <h4>4. Schema dump</h4>
  <p>
    db/schema.rb is auto generated by running migrations. Since you don't plan to run them, <code>rake db:schema:dump</code> will update schema.rb and allow it to be used with ActiveRecord.
  </p>

  <h4>5. Set custom table names</h4>
  <p>
    If the name of the tables are different from ActiveRecord convention (e.g.: you namespace the tables), add this to the model <code>self.table_name = "[custom table name]"</code>. This will help Rails find the tables and avoid error.
  </p>

  <p>
    Hope that was somewhat helpful. I'm also looking into deploying with Capistrano and submitting a pull request that would give a warning when you try to run rake db:schema:load.
  </p>
</div>

<button class='less'>Less</button>
